dist: trusty

language: python
matrix:
  include:
  - os: linux
    python: 2.7
    env: BUILD=PYPI
  - os: linux
    python: 3.4
  - os: linux
    python: 3.5
  - os: linux
    python: 3.6
  - os: linux
    python: 3.7
    dist: xenial
    sudo: true

install:
- pip install -r requirements/test.txt
- pip install -r requirements/sdk.txt
- pip install pytest-cov

script:
- flake8 connect
- pytest --cov-report=xml --cov=./connect
- sed -i "s/version='0.0.0'/version='${TRAVIS_TAG}'/g" setup.py
- sonar-scanner

after_success:
- bash <(curl -s https://codecov.io/bash)

addons:
  sonarcloud:
    organization: "cloudbluesonarcube"
    token:
      secure: "ctaTNMa3LDhL3i0/9KWQjpi/S7WjabLUU44VFc080iO/KLYC4gjbqQo/lliSbbXDirqaviZorPryro42LEHdYICd+MNriNgCQUnucO403noevV3lwmYEiV1ck6seckncqsRu/6N3UNnviJPiJz3M7YpN2QjZ3L+oKHiU2RgCh0+IFEcFr1XUK6UttzhtQ8OmvRFfakXMKCUxgfHHz9P9LgafZlZ21daOQdfF618l+sZNlwssZCAK3ATV+ro5ZN6XCGytMiVOllr1643AFj8FKxJDdKUY/YfO2byCZxF6zmZejZhcJCT9TfRvD+9fBOoONrCiBXq9/Br38C0Mq1zIfyBR9NNUIrcj4VhsmaZQroNBgTc/FL2sjEk8S2Nfr2zDwMcQJ94dyo3OW3eC8crCb3DUi/DLlzm4CGl2kmYCMTSPAlZPCapEgaZ3pH4wEXC9tqHV6PjFan5yIHHmURBNW3pGHuoNZQOY1GGh7lW01Q1WrP3IL6muPKiMfDXqTJR6irh+W+w0gWdx470e+2GfelIG11jyzT/4mJa57+s6w/e+C/v5nZ9LIC5RDUxLhpXjHxEmOzRIvmPUZRwd6j8onV6HEYHabKjAkDyl9iNrW7Mo5OejCqpm7MS99f+aiqEq4W0NzBgIaE1SAUSOm0QABOA+jTWEDrkfTtzFVs/3ibs="
deploy:
  skip_cleanup: true
  provider: pypi
  user: apslite
  password:
    secure: nzWd7Fqgi/K5YKqrAPkIBkgRImWQyQgD2/qP3fYksyJnIFWNcea5T4EKqQKXIPZHh1K0cRhT7mSjIfIrQ6H3XKM/eMTAlz6pbisG2cuu4ueUBjbxHCVCkwzBPgF7+DuCJUXJ/SHyoqMnTdAQo8fb8g69/UCmnUp37YoDO1YHXIMjFVkNc6PFS7nQElXnWkvWd1SpQgA1ZdWdwBzEnIiq+L6IFeTa83PH0Schkem/vR9Ql9CmuliovNt3yHfFaeIqLUgOmsfrwOtDVs0/SkcF+Gg5tNds7DHH2TR4fHco5s8F+n4FVgv2DUPlvBbOVvUH1RiRB8hdATetUxe1cU8fT1nPdJASLWS5E4b4knGLH53+bGxqPVezHxghbVYZHPXp7yI1zWX/Wtn9MBiAo9S3f+Tf8zTk5PIjAJLG/Sdn0RX8mLn89fsslku3enH/FknwPtG+xVYSzUlrd+yzHKnqYkKJzMjsBq/F5+shmYSDlnGdGv+Ga3xZSjIoXlphO5qpxR7vrGnLMxEPJC06+mPgPZp1qfDMyrei/IAPRP8qYPC+Vnj8yclH/UyBKT66z2UEP1z5Op99fUXi3W59x2zdVaLHYniNf16UqtrE5kc7gdLvVcH+NtbO716SAbvO5ql/JsYYTmDSoWEC9KWZS+4E7p7n45c8DEieg8Q5HThWF9Y=
  on:
    tags: true
    all_branches: true
    distributions: sdist
    condition: "$BUILD = PYPI"
